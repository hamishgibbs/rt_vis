try{var d3=require("d3")}catch(t){}var rtVis=function(){function t(){this.activeArea="United Kingdom",this.activeData="R0",this.activeTime="all",this.geoUrl="https://raw.githubusercontent.com/hamishgibbs/rt_interactive_vis/master/geo_data/world.geojson",this.summaryUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/summary_table.csv",this.r0Url="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/rt.csv",this.casesInfectionUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/cases_by_infection.csv",this.casesReportUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/cases_by_report.csv",this.obsCasesUrl="https://opendata.ecdc.europa.eu/covid19/casedistribution/csv",this._requiredData=Promise.all([d3.json(this.geoUrl),d3.csv(this.summaryUrl),d3.csv(this.r0Url),d3.csv(this.casesInfectionUrl),d3.csv(this.casesReportUrl)]),this._dataset_ref={R0:{index:2,title:"R"},casesInfection:{index:3,title:"Cases by date of infection"},casesReport:{index:4,title:"Cases by date of report"}}}return t.prototype.setupPage=function(){var e={r0ButtonClick:this.r0ButtonClick.bind(this),casesInfectionButtonClick:this.casesInfectionButtonClick.bind(this),casesReportButtonClick:this.casesReportButtonClick.bind(this),time7ButtonClick:this.time7ButtonClick.bind(this),time14ButtonClick:this.time14ButtonClick.bind(this),time30ButtonClick:this.time30ButtonClick.bind(this),timeAllButtonClick:this.timeAllButtonClick.bind(this)};this._requiredData.then(function(t){(new setup).setupLayout(e)})},t.prototype.createMap=function(){var e=this.mapClick.bind(this),a=this.dropdownClick.bind(this);this._requiredData.then(function(t){(new map).setupMap(t[0],t[1],e,a)})},t.prototype.plotRt=function(a){var i,n=this.activeArea,r=this.activeTime,o=this._dataset_ref;i="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[o[a].index],n,r,i),e.tsTitle(n,o[a].title)})},t.prototype.r0ButtonClick=function(){var a=this.activeArea,i=this.activeTime;this._requiredData.then(function(t){var e=new ts;e.plotTs(t[2],a,i,!0),e.tsTitle(a,"Cases by date of infection")}),this.activeData="R0"},t.prototype.casesInfectionButtonClick=function(){var a=this.activeArea,i=this.activeTime;this._requiredData.then(function(t){var e=new ts;e.plotTs(t[3],a,i),e.tsTitle(a,"Cases by date of infection")}),this.activeData="casesInfection"},t.prototype.casesReportButtonClick=function(){var a=this.activeArea,i=this.activeTime;this._requiredData.then(function(t){var e=new ts;e.plotTs(t[4],a,i),e.tsTitle(a,"Cases by date of report")}),this.activeData="casesReport"},t.prototype.time7ButtonClick=function(){var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,"7d",a),e.tsTitle(i,r)}),this.activeTime="7d"},t.prototype.time14ButtonClick=function(){var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,"14d",a),e.tsTitle(i,r)}),this.activeTime="14d"},t.prototype.time30ButtonClick=function(){var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,"30d",a),e.tsTitle(i,r)}),this.activeTime="30d"},t.prototype.timeAllButtonClick=function(){var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,"all",a),e.tsTitle(i,r)}),this.activeTime="all"},t.prototype.mapClick=function(t){this.activeArea=t.properties.sovereignt;var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title,o=this.activeTime;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,o,a),e.tsTitle(i,r)})},t.prototype.dropdownClick=function(t){this.activeArea=t.params.data.text;var a,i=this.activeArea,n=this._dataset_ref[this.activeData].index,r=this._dataset_ref[this.activeData].title,o=this.activeTime;a="R0"===this.activeData,this._requiredData.then(function(t){var e=new ts;e.plotTs(t[n],i,o,a),e.tsTitle(i,r)}),d3.select("#select2-dropdown-container-container").text(this.activeArea)},t}(),vis=new rtVis;vis.setupPage(),vis.createMap(),vis.plotRt("R0");var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var setup=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setupLayout=function(t){d3.select("#root").append("div").attr("class","map-container").attr("id","map-container"),d3.select("#map-container").append("div").attr("class","dropdown-container").attr("id","dropdown-container"),d3.select("#root").append("div").attr("class","title-container").attr("id","title-container"),d3.select("#root").append("div").attr("class","ts-container").attr("id","ts-container"),d3.select("#root").append("div").attr("class","controls-container").attr("id","controls-container"),d3.select("#root").append("div").attr("class","download-container").attr("id","download-container"),d3.select("#controls-container").append("div").attr("class","controls-container-data").attr("id","controls-container-data"),d3.select("#controls-container").append("div").attr("class","controls-container-time").attr("id","controls-container-time"),d3.select("#controls-container-data").append("button").attr("class","control-button").attr("id","control-r0").text("R").on("click",t.r0ButtonClick),this.addButtonSpacer("#controls-container-data"),d3.select("#controls-container-data").append("button").attr("class","control-button").attr("id","control-casesInfection").text("Cases by date of infection").on("click",t.casesInfectionButtonClick),this.addButtonSpacer("#controls-container-data"),d3.select("#controls-container-data").append("button").attr("class","control-button").attr("id","control-casesReport").text("Cases by date of report").on("click",t.casesReportButtonClick),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-allday").text("All").on("click",t.timeAllButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-30day").text("Previous Month").on("click",t.time30ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-7day").text("Previous 2 weeks").on("click",t.time14ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-5day").text("Previous 7 Days").on("click",t.time7ButtonClick),d3.select("#download-container").append("div").text("Download data:"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-r0").text("R").attr("href",this.r0Url).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesInfection").text("Cases by date of infection").attr("href",this.casesInfectionUrl).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesReport").text("Cases by date of report").attr("href",this.casesReportUrl).attr("target","_blank")},e.prototype.addButtonSpacer=function(t){d3.select(t).append("div").attr("class","button-spacer")},e}(rtVis),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var map=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setupMap=function(t,a,e,i){var n=d3.select("#map-container").append("svg").attr("class","map-svg").style("width","100%").style("height","100%"),r=document.getElementById("map-container").getBoundingClientRect(),o=d3.geoCylindricalStereographic().translate([r.width/2,r.height/2]).scale(150).center([0,10]),s=d3.geoPath().projection(o),c={Decreasing:"#1170aa","Likely decreasing":"#5fa2ce",Unsure:"#7b848f","Likely increasing":"#fd9e49",Increasing:"#e75f00","No Data":"lightgray"};n.append("g").attr("class","areas").selectAll("path").data(t.features).enter().append("path").attr("class","area-poly").attr("d",s).attr("stroke","white").attr("summary",function(e){try{return a.filter(function(t){return t.Country==e.properties.sovereignt})[0]["Expected change in daily cases"]}catch(t){return"No Data"}}).attr("country-name",function(t){return t.properties.sovereignt}).attr("fill",function(t){return c[d3.select(this).attr("summary")]}).on("mouseover",this.mapMouseIn).on("mouseout",this.mapMouseOut).on("click",e).style("stroke","black").style("stroke-width","0.2px"),this.createLegend(n,r,c);var l=t.features.map(function(t){return t.properties.sovereignt}).filter(this.onlyUnique).sort();$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select a country",data:l}).on("select2:select",i)},e.prototype.mapMouseIn=function(t){d3.select(this).style("stroke","black").style("stroke-width","1.5px")},e.prototype.mapMouseOut=function(t){d3.select(this).style("stroke","black").style("stroke-width","0.5px")},e.prototype.createLegend=function(t,e,a){var i,n=e.width/30,r=e.height/2;for(t.append("rect").attr("x",n).attr("y",r).attr("width",185).attr("height",200).attr("fill","white").attr("stroke","black").attr("stroke-width","0.5px").attr("rx",8),t.append("text").attr("x",6+n).attr("y",20+r).text("Expected change in cases").style("font-size","10pt").style("font-weight","bold"),i=0;i<Object.entries(a).length;i++)t.append("rect").attr("x",6+n).attr("y",r+200/7*(i+1)+5).attr("width",12).attr("height",12).attr("fill",Object.entries(a)[i][1]),t.append("text").attr("x",23+n).attr("y",r+200/7*(i+1)+15).text(Object.entries(a)[i][0]).style("font-size","12")},e.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},e}(rtVis),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var ts=function(e){function t(){var t=e.call(this)||this;return t.margin={top:30,right:30,bottom:30,left:60},t}return __extends(t,e),t.prototype.plotTs=function(n,e,t,a){void 0===a&&(a=!1),d3.select("#ts-svg").remove(),d3.select("#ts-tooltip").remove(),n=n.filter(function(t){return t.country==e});var r=d3.timeParse("%Y-%m-%d"),i=d3.select("#ts-container").append("svg").attr("class","ts-svg").attr("id","ts-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),o=document.getElementById("ts-container").getBoundingClientRect();o.width=o.width-this.margin.left-this.margin.right,o.height=o.height-this.margin.top-this.margin.bottom;var s,c,l,d,p,u,h,f,y,v,m,_=d3.min(n,function(t){return r(t.date)});"7d"===t?_=new Date(Date.now()-6048e5):"14d"===t?_=new Date(Date.now()-12096e5):"30d"===t&&(_=new Date(Date.now()-2592e6)),0!==(n=n.filter(function(t){return r(t.date)>=_})).length?(s=d3.max(n,function(t){return r(t.date)}),c=d3.max(n,function(t){return parseFloat(t.upper_90)}),l=d3.scaleLinear().domain([0,c]).range([o.height,0]),d=d3.scaleTime().domain([_,s]).range([0,o.width]),p=d3.line().x(function(t){return d(r(t.date))}).y(function(t){return l(1)}).curve(d3.curveCardinal),u=n.filter(function(t){return"estimate"==t.type}),h=n.filter(function(t){return"estimate based on partial data"==t.type}),f=n.filter(function(t){return"forecast"==t.type}),y=this.plotHPoly("date","upper_90","lower_90",d,l,r),v=this.plotHPoly("date","upper_50","lower_50",d,l,r),i.append("path").datum(u).attr("d",y).attr("class","poly_90_e"),i.append("path").datum(h).attr("d",y).attr("class","poly_90_eb"),i.append("path").datum(f).attr("d",y).attr("class","poly_90_f"),i.append("path").datum(u).attr("d",v).attr("class","poly_50_e"),i.append("path").datum(h).attr("d",v).attr("class","poly_50_eb"),i.append("path").datum(f).attr("d",v).attr("class","poly_50_f"),a&&i.append("path").datum(n).attr("d",p).attr("class","r0_line").style("stroke","black").style("stroke-dasharray","5,5"),i.append("g").attr("transform","translate(0,"+o.height+")").call(d3.axisBottom(d)).attr("class","r0-xaxis"),i.append("g").call(d3.axisLeft(l)).attr("class","r0-yaxis"),i.append("line").attr("id","ts-hover-line").attr("x1",20).attr("y1",0).attr("x2",20).attr("y2",o.height).attr("stroke","black").attr("stroke-width","1px").attr("stroke-opacity",0),m=d3.select("#ts-container").append("div").style("opacity",0).attr("class","tooltip").attr("id","ts-tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px").style("font-size","9pt").style("overflow","visible"),i.append("rect").attr("class","overlay").attr("width",o.width).attr("height",o.height).on("mousemove",function(){var e=this;d3.select("#ts-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0]),console.log(d.invert(d3.mouse(this)[0]).toDateString(),l.invert(d3.mouse(this)[1]));var t=n.filter(function(t){return r(t.date).toDateString()==d.invert(d3.mouse(e)[0]).toDateString()}),a="<b>"+r(t[0].date).toDateString()+"</b><br>50% CI: "+parseFloat(t[0].lower_50)+" to "+parseFloat(t[0].upper_50)+"<br>90% CI: "+parseFloat(t[0].lower_90)+" to "+parseFloat(t[0].upper_90),i=o.width-d3.mouse(this)[0]<80?-70:70;m.html(a).style("left",d3.mouse(this)[0]+i+"px").style("top",d3.mouse(this)[1]-270+"px"),console.log(t[0])}).on("mouseenter",this.tsMouseIn).on("mouseout",this.tsMouseOut).attr("fill-opacity","0")):i.append("text").attr("x",o.width/2).attr("y",o.height/2).text("No data").style("font-size","20px").style("stroke-width",0).style("fill","gray")},t.prototype.tsMouseMove=function(t){console.log(this),d3.select("#ts-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0])},t.prototype.tsMouseIn=function(t){d3.select("#ts-tooltip").style("opacity",1),d3.select("#ts-hover-line").attr("stroke-opacity",1)},t.prototype.tsMouseOut=function(t){d3.select("#ts-tooltip").style("opacity",0),d3.select("#ts-hover-line").attr("stroke-opacity",0)},t.prototype.tsTitle=function(t,e){d3.select("#title-container").text(t+" - "+e)},t.prototype.plotHPoly=function(e,a,i,n,r,o){return void 0===o&&(o=null),null!==o?d3.area().x(function(t){return n(o(t[e]))}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[i])}):d3.area().x(function(t){return n(t[e])}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[i])})},t}(rtVis);