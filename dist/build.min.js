try{var d3=require("d3")}catch(t){}var rtVis=function(){function t(){this.activeArea="United Kingdom",this.activeData="R0",this.activeTime="all",this.geoUrl="https://raw.githubusercontent.com/hamishgibbs/rt_interactive_vis/master/geo_data/world.geojson",this.summaryUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/summary_table.csv",this.r0Url="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/rt.csv",this.casesInfectionUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/cases_by_infection.csv",this.casesReportUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/cases_by_report.csv",this.obsCasesUrl="https://raw.githubusercontent.com/epiforecasts/covid-rt-estimates/master/national/cases/summary/reported_cases.csv",this._requiredData=Promise.all([d3.json(this.geoUrl),d3.csv(this.summaryUrl),d3.csv(this.r0Url),d3.csv(this.casesInfectionUrl),d3.csv(this.casesReportUrl),d3.csv(this.obsCasesUrl)]),this._dataset_ref={R0:{index:2,title:"R"},casesInfection:{index:3,title:"Cases by date of infection"},casesReport:{index:4,title:"Cases by date of report"}},this._subregional_ref={Afghanistan:"https://epiforecasts.io/covid/posts/national/afghanistan/",Brazil:"https://epiforecasts.io/covid/posts/national/brazil/",Colombia:"https://epiforecasts.io/covid/posts/national/colombia/",India:"https://epiforecasts.io/covid/posts/national/india/",Italy:"https://epiforecasts.io/covid/posts/national/italy/",Germany:"https://epiforecasts.io/covid/posts/national/germany/",Russia:"https://epiforecasts.io/covid/posts/national/russia/","United Kingdom":"https://epiforecasts.io/covid/posts/national/united-kingdom/","United States of America":"https://epiforecasts.io/covid/posts/national/united-states/"}}return t.prototype.setupPage=function(){var e={time7ButtonClick:this.time7ButtonClick.bind(this),time14ButtonClick:this.time14ButtonClick.bind(this),time30ButtonClick:this.time30ButtonClick.bind(this),timeAllButtonClick:this.timeAllButtonClick.bind(this)};this._requiredData.then(function(t){(new setup).setupLayout(e)})},t.prototype.createMap=function(){var e=this.mapClick.bind(this),a=this.dropdownClick.bind(this);this._requiredData.then(function(t){(new map).setupMap(t[0],t[1],e,a)})},t.prototype.plotRt=function(t){var a=this.activeArea,i=this.activeTime;this._dataset_ref;this.activeData,this._requiredData.then(function(t){var e=new ts;e.tsCountryTitle(a,"country-title-container"),e.plotTs(t[2],a,i,t[5],"r0-ts-container",!0),e.tsDataTitle("R","r0-title-container"),e.plotTs(t[3],a,i,t[5],"cases-infection-ts-container",!1),e.tsDataTitle("Cases by date of infection","cases-infection-title-container"),e.plotTs(t[4],a,i,t[5],"cases-report-ts-container",!1),e.tsDataTitle("Cases by date of report","cases-report-title-container")})},t.prototype.time7ButtonClick=function(){var i=this.activeArea;this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title;this.activeData,this._requiredData.then(function(t){var e=new ts,a="7d";console.log(t),e.plotTs(t[2],i,a,t[5],"r0-ts-container",!0),e.tsDataTitle("R","r0-title-container"),e.plotTs(t[3],i,a,t[5],"cases-infection-ts-container",!1),e.tsDataTitle("Cases by date of infection","cases-infection-title-container"),e.plotTs(t[4],i,a,t[5],"cases-report-ts-container",!1),e.tsDataTitle("Cases by date of report","cases-report-title-container")}),this.activeTime="7d"},t.prototype.time14ButtonClick=function(){var i=this.activeArea;this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title;this.activeData,this._requiredData.then(function(t){var e=new ts,a="14d";e.plotTs(t[2],i,a,t[5],"r0-ts-container",!0),e.tsDataTitle("R","r0-title-container"),e.plotTs(t[3],i,a,t[5],"cases-infection-ts-container",!1),e.tsDataTitle("Cases by date of infection","cases-infection-title-container"),e.plotTs(t[4],i,a,t[5],"cases-report-ts-container",!1),e.tsDataTitle("Cases by date of report","cases-report-title-container")}),this.activeTime="14d"},t.prototype.time30ButtonClick=function(){var i=this.activeArea;this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title;this.activeData,this._requiredData.then(function(t){var e=new ts,a="30d";e.plotTs(t[2],i,a,t[5],"r0-ts-container",!0),e.tsDataTitle("R","r0-title-container"),e.plotTs(t[3],i,a,t[5],"cases-infection-ts-container",!1),e.tsDataTitle("Cases by date of infection","cases-infection-title-container"),e.plotTs(t[4],i,a,t[5],"cases-report-ts-container",!1),e.tsDataTitle("Cases by date of report","cases-report-title-container")}),this.activeTime="30d"},t.prototype.timeAllButtonClick=function(){var i=this.activeArea;this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title;this.activeData,this._requiredData.then(function(t){var e=new ts,a="all";e.plotTs(t[2],i,a,t[5],"r0-ts-container",!0),e.tsDataTitle("R","r0-title-container"),e.plotTs(t[3],i,a,t[5],"cases-infection-ts-container",!1),e.tsDataTitle("Cases by date of infection","cases-infection-title-container"),e.plotTs(t[4],i,a,t[5],"cases-report-ts-container",!1),e.tsDataTitle("Cases by date of report","cases-report-title-container")}),this.activeTime="all"},t.prototype.mapClick=function(t){this.activeArea=t.properties.sovereignt;var a=this.activeArea,i=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.activeTime);this.activeData,this._requiredData.then(function(t){var e=new ts;e.tsCountryTitle(a,"country-title-container"),e.plotTs(t[2],a,i,t[5],"r0-ts-container",!0),e.plotTs(t[3],a,i,t[5],"cases-infection-ts-container",!1),e.plotTs(t[4],a,i,t[5],"cases-report-ts-container",!1)})},t.prototype.dropdownClick=function(t){this.activeArea=t.params.data.text;var a=this.activeArea,i=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.activeTime);this.activeData,this._requiredData.then(function(t){var e=new ts;e.tsCountryTitle(a,"country-title-container"),e.plotTs(t[2],a,i,t[5],"r0-ts-container",!0),e.plotTs(t[3],a,i,t[5],"cases-infection-ts-container",!1),e.plotTs(t[4],a,i,t[5],"cases-report-ts-container",!1)}),d3.select("#select2-dropdown-container-container").text(this.activeArea)},t}(),vis=new rtVis;vis.setupPage(),vis.createMap(),vis.plotRt("R0");var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var setup=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setupLayout=function(t){d3.select("#root").append("div").attr("class","map-container").attr("id","map-container"),d3.select("#map-container").append("div").attr("class","dropdown-container").attr("id","dropdown-container"),d3.select("#root").append("div").attr("class","country-title-container").attr("id","country-title-container"),d3.select("#root").append("div").attr("class","r0-title-container").attr("id","r0-title-container"),d3.select("#root").append("div").attr("class","r0-ts-container").attr("id","r0-ts-container"),d3.select("#root").append("div").attr("class","cases-infection-title-container").attr("id","cases-infection-title-container"),d3.select("#root").append("div").attr("class","cases-infection-ts-container").attr("id","cases-infection-ts-container"),d3.select("#root").append("div").attr("class","cases-report-title-container").attr("id","cases-report-title-container"),d3.select("#root").append("div").attr("class","cases-report-ts-container").attr("id","cases-report-ts-container"),d3.select("#root").append("div").attr("class","controls-container").attr("id","controls-container"),d3.select("#root").append("div").attr("class","footer"),d3.select("#root").append("div").attr("class","download-container").attr("id","download-container"),d3.select("#controls-container").append("div").attr("class","controls-container-legend").attr("id","controls-container-legend"),d3.select("#controls-container").append("div").attr("class","controls-container-time").attr("id","controls-container-time"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-e"),d3.select("#controls-container-legend").append("div").text("Estimate").attr("class","ts-legend-text"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-eb"),d3.select("#controls-container-legend").append("div").text("Estimate based on partial data").attr("class","ts-legend-text"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-f"),d3.select("#controls-container-legend").append("div").text("Forecast").attr("class","ts-legend-text"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-allday").text("All").on("click",t.timeAllButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-30day").text("Previous Month").on("click",t.time30ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-7day").text("Previous 2 weeks").on("click",t.time14ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-5day").text("Previous 7 Days").on("click",t.time7ButtonClick),d3.select("#download-container").append("div").text("Download data:"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-r0").text("R").attr("href",this.r0Url).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesInfection").text("Cases by date of infection").attr("href",this.casesInfectionUrl).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesReport").text("Cases by date of report").attr("href",this.casesReportUrl).attr("target","_blank")},e.prototype.addButtonSpacer=function(t){d3.select(t).append("div").attr("class","button-spacer")},e}(rtVis),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var map=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setupMap=function(t,a,e,i){var n=d3.select("#map-container").append("svg").attr("class","map-svg").style("width","100%").style("height","100%"),r=document.getElementById("map-container").getBoundingClientRect(),s=d3.geoCylindricalStereographic().translate([r.width/2,r.height/2]).scale(150).center([0,10]),o=d3.geoPath().projection(s),c={Decreasing:"#1170aa","Likely decreasing":"#5fa2ce",Unsure:"#7b848f","Likely increasing":"#fd9e49",Increasing:"#e75f00","No Data":"lightgray"};n.append("g").attr("class","areas").selectAll("path").data(t.features).enter().append("path").attr("class","area-poly").attr("d",o).attr("stroke","white").attr("summary",function(e){try{return a.filter(function(t){return t.Country==e.properties.sovereignt})[0]["Expected change in daily cases"]}catch(t){return"No Data"}}).attr("country-name",function(t){return t.properties.sovereignt}).attr("fill",function(t){return c[d3.select(this).attr("summary")]}).on("mouseover",this.mapMouseIn).on("mouseout",this.mapMouseOut).on("click",e).style("stroke","black").style("stroke-width","0.2px"),this.createLegend(n,r,c);var l=t.features.map(function(t){return t.properties.sovereignt}).filter(this.onlyUnique).sort();$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select a country",data:l}).on("select2:select",i)},e.prototype.mapMouseIn=function(t){d3.select(this).style("stroke","black").style("stroke-width","1.5px")},e.prototype.mapMouseOut=function(t){d3.select(this).style("stroke","black").style("stroke-width","0.5px")},e.prototype.createLegend=function(t,e,a){var i,n=e.width/30,r=e.height/2;for(t.append("rect").attr("x",n).attr("y",r).attr("width",185).attr("height",200).attr("fill","white").attr("stroke","black").attr("stroke-width","0.5px").attr("rx",8),t.append("text").attr("x",6+n).attr("y",20+r).text("Expected change in cases").style("font-size","10pt").style("font-weight","bold"),i=0;i<Object.entries(a).length;i++)t.append("rect").attr("x",6+n).attr("y",r+200/7*(i+1)+5).attr("width",12).attr("height",12).attr("fill",Object.entries(a)[i][1]),t.append("text").attr("x",23+n).attr("y",r+200/7*(i+1)+15).text(Object.entries(a)[i][0]).style("font-size","12")},e.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},e}(rtVis),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var ts=function(e){function t(){var t=e.call(this)||this;return t.margin={top:10,right:30,bottom:30,left:60},t}return __extends(t,e),t.prototype.plotTs=function(n,e,t,a,r,i){void 0===i&&(i=!1),d3.select("#"+r+"-svg").remove(),d3.select("#"+r+"-tooltip").remove(),n=n.filter(function(t){return t.country==e}),a=a.filter(function(t){return t.region==e});var s=d3.timeParse("%Y-%m-%d"),o=d3.select("#"+r).append("svg").attr("class",r+"-svg").attr("id",r+"-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),c=document.getElementById(r).getBoundingClientRect();c.width=c.width-this.margin.left-this.margin.right,c.height=c.height-this.margin.top-this.margin.bottom;var l,d,p,u,h,f,y,v,m,_,g,b=d3.min(n,function(t){return s(t.date)});"7d"===t?b=new Date(Date.now()-6048e5):"14d"===t?b=new Date(Date.now()-12096e5):"30d"===t&&(b=new Date(Date.now()-2592e6)),n=n.filter(function(t){return s(t.date)>=b}),a=a.filter(function(t){return d3.timeDay.offset(s(t.date),-1)>=b}),0!==n.length?(l=d3.max(n,function(t){return s(t.date)}),d=d3.max(n,function(t){return parseFloat(t.upper_90)}),p=d3.scaleLinear().domain([0,d]).range([c.height,0]),u=d3.scaleTime().domain([b,l]).range([0,c.width]),h=d3.line().x(function(t){return u(s(t.date))}).y(function(t){return p(1)}).curve(d3.curveCardinal),f=n.filter(function(t){return"estimate"==t.type}),y=n.filter(function(t){return"estimate based on partial data"==t.type}),v=n.filter(function(t){return"forecast"==t.type}),m=this.plotHPoly("date","upper_90","lower_90",u,p,s),_=this.plotHPoly("date","upper_50","lower_50",u,p,s),i||o.selectAll("rect").data(a).enter().append("rect").attr("height",function(t,e){return c.height-p(t.confirm)}).attr("y",function(t,e){return p(t.confirm)}).attr("width",function(t){return u(d3.timeDay.offset(s(t.date),1))-u(s(t.date))}).attr("x",function(t,e){return u(d3.timeDay.offset(s(t.date),-.5))}).attr("class","cases_bar"),o.append("path").datum(f).attr("d",m).attr("class","poly_90_e"),o.append("path").datum(y).attr("d",m).attr("class","poly_90_eb"),o.append("path").datum(v).attr("d",m).attr("class","poly_90_f"),o.append("path").datum(f).attr("d",_).attr("class","poly_50_e"),o.append("path").datum(y).attr("d",_).attr("class","poly_50_eb"),o.append("path").datum(v).attr("d",_).attr("class","poly_50_f"),i&&o.append("path").datum(n).attr("d",h).attr("class","r0_line").style("stroke","black").style("stroke-dasharray","5,5"),o.append("g").attr("transform","translate(0,"+c.height+")").call(d3.axisBottom(u)).attr("class","r0-xaxis"),o.append("g").call(d3.axisLeft(p)).attr("class","r0-yaxis"),o.append("line").attr("id",r+"-hover-line").attr("x1",20).attr("y1",0).attr("x2",20).attr("y2",c.height).attr("stroke","black").attr("stroke-width","1px").attr("stroke-opacity",0),g=d3.select("#"+r).append("div").style("opacity",0).attr("class",r+"-tooltip").attr("id",r+"-tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px").style("font-size","9pt").style("overflow","visible").style("position","relative").style("display","inline-block"),o.append("rect").attr("class","overlay").attr("width",c.width).attr("height",c.height).on("mousemove",function(){var e=this;d3.select("#"+r+"-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0]);var t=n.filter(function(t){return s(t.date).toDateString()==u.invert(d3.mouse(e)[0]).toDateString()}),a="<b>"+s(t[0].date).toDateString()+"</b><br>50% CI: "+parseFloat(t[0].lower_50)+" to "+parseFloat(t[0].upper_50)+"<br>90% CI: "+parseFloat(t[0].lower_90)+" to "+parseFloat(t[0].upper_90),i=c.width-d3.mouse(this)[0]<80?-70:70;g.html(a).style("left",d3.mouse(this)[0]+i+"px").style("top",d3.mouse(this)[1]-200+"px")}).on("mouseenter",function(t){d3.select("#"+r+"-tooltip").style("opacity",1),d3.select("#"+r+"-hover-line").attr("stroke-opacity",1)}).on("mouseout",function(t){d3.select("#"+r+"-tooltip").style("opacity",0),d3.select("#"+r+"-hover-line").attr("stroke-opacity",0)}).attr("fill-opacity","0")):o.append("text").attr("x",c.width/2).attr("y",c.height/2).text("No data").style("font-size","20px").style("stroke-width",0).style("fill","gray")},t.prototype.tsDataTitle=function(t,e){d3.select("#"+e).text(t)},t.prototype.tsCountryTitle=function(t,e){var a=Object.keys(this._subregional_ref).includes(t)?'<a href="'+this._subregional_ref[t]+'" target="_blank">'+t+"</a>":t;d3.select("#"+e).html(a)},t.prototype.plotHPoly=function(e,a,i,n,r,s){return void 0===s&&(s=null),null!==s?d3.area().x(function(t){return n(s(t[e]))}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[i])}):d3.area().x(function(t){return n(t[e])}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[i])})},t}(rtVis);