try{var d3=require("d3")}catch(t){}var rtVis=function(){function t(t){this._config=t,this.activeArea=t.activeArea,this.activeTime=t.activeTime,this.runDate=t.runDate,this.sourceDeaths=!1,this.activeSource=Object.keys(t.rtData)[0],Object.values(t.rtData[this.activeSource]).filter(function(t){return null!==t})[0].then?this._requiredData=this.recursiveObjectPromiseAll([{geoData:t.geoData,summaryData:t.summaryData,rtData:t.rtData}]):this._requiredData=Promise.all([{geoData:t.geoData,summaryData:t.summaryData,rtData:t.rtData,obsCasesData:t.obsCasesData}]),this._dataset_ref=[{geoData:{index:0,title:"Geography"}},{summaryData:{index:1,title:"Summary"}},{rtData:{rtData:{index:0,title:"R"},casesInfectionData:{index:1,title:"Cases by date of infection"},casesReportData:{index:2,title:"Cases by date of report"}}},{obsCasesData:{index:5,title:"Observed cases"}}],this._subregional_ref=t.subregional_ref,this._availableData=[]}return t.prototype.setupFlex=function(n){function i(t,e,a){return a.indexOf(t)===e}var o={time7ButtonClick:this.time7ButtonClick.bind(this),time14ButtonClick:this.time14ButtonClick.bind(this),time30ButtonClick:this.time30ButtonClick.bind(this),timeAllButtonClick:this.timeAllButtonClick.bind(this),dropdownClick:this.dropdownClick.bind(this),sourceSelectClick:this.sourceSelectClick.bind(this)},s=(this._dataset_ref,this._config),c=(this.getAvailableData,this.activeArea),l=this.activeTime,d=this.runDate,p=this.activeSource;this._requiredData.then(function(t){t=t[0];var e=new setup(s),a=new ts(s);e.setupDropDown(n),null!==t.geoData&&null!==t.summaryData&&e.setupMap(n);try{var r=t.rtData[p].rtData.map(function(t){return t.country}).filter(i).sort()}catch(t){}try{r=t.rtData[p].casesInfectionData.map(function(t){return t.country}).filter(i).sort()}catch(t){}try{r=t.rtData[p].casesReportData.map(function(t){return t.country}).filter(i).sort()}catch(t){}$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select an area",data:r}).on("select2:select",o.dropdownClick),1<Object.keys(t.rtData).length&&e.addSourceSelect(n,"source-select",Object.keys(t.rtData),o.sourceSelectClick),e.setupCountryTitle(n),a.tsCountryTitle(c,"country-title-container"),null!==t.rtData[p].rtData&&e.setupRt(n),null!==t.rtData[p].casesInfectionData&&e.setupCasesInfection(n),null!==t.rtData[p].casesReportData&&e.setupCasesReport(n),null===t.rtData[p].rtData&&null===t.rtData[p].casesInfectionData&&null===t.rtData[p].casesReportData||e.setupControls(n,o),e.setupFooter(n),a.plotAllTs(c,l,t,p,d)})},t.prototype.getAvailableData=function(t,e){var a=t.map(function(t,e){return null!==t?e:""}).filter(String);return a=(a=a.map(function(t){return e[t]})).map(function(t){return Object.keys(t)}).flat()},t.prototype.setupPage=function(t){this.setupFlex(t)},t.prototype.createMap=function(){var e=this._config,a=this.mapClick.bind(this),r=this.dropdownClick.bind(this);this.getAvailableData;this._requiredData.then(function(t){new map(e).setupMap(t[0].geoData,t[0].summaryData,a,r)})},t.prototype.plotRt=function(t){var e=this._config,a=(this._dataset_ref,this.activeArea),r=this.activeTime,n=(this.getAvailableData,this.runDate),i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t.prototype.time7ButtonClick=function(){var e=this._config,a=(this._dataset_ref,this.activeArea),r=(this.getAvailableData,this.runDate),n=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,"7d",t[0],n,r)}),this.activeTime="7d"},t.prototype.time14ButtonClick=function(){var e=this._config,a=(this._dataset_ref,this.activeArea),r=(this.getAvailableData,this.runDate),n=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,"14d",t[0],n,r)}),this.activeTime="14d"},t.prototype.time30ButtonClick=function(){var e=this._config,a=(this._dataset_ref,this.activeArea),r=(this.getAvailableData,this.runDate),n=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,"30d",t[0],n,r)}),this.activeTime="30d"},t.prototype.timeAllButtonClick=function(){var e=this._config,a=(this._dataset_ref,this.activeArea),r=(this.getAvailableData,this.runDate),n=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,"all",t[0],n,r)}),this.activeTime="all"},t.prototype.mapClick=function(t){this.activeArea=t.properties.sovereignt;var e=this._config,a=(this._dataset_ref,this.activeArea),r=this.activeTime,n=(this.getAvailableData,this.runDate),i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t.prototype.dropdownClick=function(t){this.activeArea=t.params.data.text;var e=this._config,a=(this._dataset_ref,this.activeArea),r=this.activeTime,n=(this.getAvailableData,this.runDate),i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)}),d3.select("#select2-dropdown-container-container").text(this.activeArea)},t.prototype.sourceSelectClick=function(t){this.activeSource=d3.select("#source-select :checked").text();var e=this._config,a=(this._dataset_ref,this.activeArea),r=this.activeTime,n=(this.getAvailableData,this.runDate),i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t.prototype.zipObject=function(t,a){var r={};return t.forEach(function(t,e){r[t]=a[e]}),r},t.prototype.recursiveObjectPromiseAll=function(a){var r=this,e=Object.keys(a);return Promise.all(e.map(function(t){var e=a[t];return"object"!=typeof e||e.then?e:r.recursiveObjectPromiseAll(e)})).then(function(t){return r.zipObject(e,t)})},t}(),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var setup=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setupCountryTitle=function(t){d3.select(t).append("div").attr("class","country-title-container").attr("id","country-title-container")},t.prototype.setupMap=function(t){d3.select(t).append("div").attr("class","map-container").attr("id","map-container")},t.prototype.setupDropDown=function(t){d3.select(t).append("div").attr("class","dropdown-container").attr("id","dropdown-container")},t.prototype.setupRt=function(t){d3.select(t).append("div").attr("class","r0-title-container").attr("id","r0-title-container"),d3.select(t).append("div").attr("class","r0-ts-container").attr("id","r0-ts-container")},t.prototype.setupCasesInfection=function(t){d3.select(t).append("div").attr("class","cases-infection-title-container").attr("id","cases-infection-title-container"),d3.select(t).append("div").attr("class","cases-infection-ts-container").attr("id","cases-infection-ts-container")},t.prototype.setupCasesReport=function(t){d3.select(t).append("div").attr("class","cases-report-title-container").attr("id","cases-report-title-container"),d3.select(t).append("div").attr("class","cases-report-ts-container").attr("id","cases-report-ts-container")},t.prototype.setupControls=function(t,e){d3.select(t).append("div").attr("class","controls-container").attr("id","controls-container"),d3.select("#controls-container").append("div").attr("class","controls-container-legend").attr("id","controls-container-legend"),d3.select("#controls-container").append("div").attr("class","controls-container-time").attr("id","controls-container-time"),d3.select("#controls-container-legend").append("div").attr("class","legend-e").attr("id","legend-e"),d3.select("#controls-container-legend").append("div").attr("class","legend-eb").attr("id","legend-eb"),d3.select("#controls-container-legend").append("div").attr("class","legend-f").attr("id","legend-f"),d3.select("#legend-e").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-e"),d3.select("#legend-e").append("div").text("Estimate").attr("class","ts-legend-text"),d3.select("#legend-eb").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-eb"),d3.select("#legend-eb").append("div").text("Estimate based on partial data").attr("class","ts-legend-text"),d3.select("#legend-f").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-f"),d3.select("#legend-f").append("div").text("Forecast").attr("class","ts-legend-text"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-allday").text("All").on("click",e.timeAllButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-30day").text("Previous Month").on("click",e.time30ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-7day").text("Previous 2 weeks").on("click",e.time14ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-5day").text("Previous 7 Days").on("click",e.time7ButtonClick),d3.select("#download-container").append("div").text("Download data:"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-r0").text("R").attr("href",this.r0Url).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesInfection").text("Cases by date of infection").attr("href",this.casesInfectionUrl).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesReport").text("Cases by date of report").attr("href",this.casesReportUrl).attr("target","_blank")},t.prototype.setupFooter=function(t){d3.select(t).append("div").attr("class","footer")},t.prototype.addSourceSelect=function(t,e,a,r){for(var n=d3.select(t).append("select").attr("class",e).attr("id",e).on("change",r),i=0;i<a.length;i++)n.append("option").text(a[i])},t.prototype.addButtonSpacer=function(t){d3.select(t).append("div").attr("class","button-spacer")},t}(rtVis),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var map=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setupMap=function(t,a,e,r){var n=d3.select("#map-container").append("svg").attr("class","map-svg").style("width","100%").style("height","100%"),i=document.getElementById("map-container").getBoundingClientRect(),o=d3.geoCylindricalStereographic(),s=d3.geoPath().projection(o),c=this.calculateScaleCenter(t,i.width,i.height,s),o=d3.geoCylindricalStereographic().translate([i.width/2,i.height/2]).scale(c.scale).center(c.center),s=d3.geoPath().projection(o),l={Decreasing:"#1170aa","Likely decreasing":"#5fa2ce",Unsure:"#7b848f","Likely increasing":"#fd9e49",Increasing:"#e75f00","No Data":"lightgray"};n.append("g").attr("class","areas").selectAll("path").data(t.features).enter().append("path").attr("class","area-poly").attr("d",s).attr("stroke","white").attr("summary",function(e){try{return a.filter(function(t){return t.Country==e.properties.sovereignt})[0]["Expected change in daily cases"]}catch(t){return"No Data"}}).attr("country-name",function(t){return t.properties.sovereignt}).attr("fill",function(t){return l[d3.select(this).attr("summary")]}).on("mouseover",this.mapMouseIn).on("mouseout",this.mapMouseOut).on("click",e).style("stroke","black").style("stroke-width","0.2px").style("opacity",.5).transition().delay(50).style("opacity",1),this.createLegend(n,i,l);var d=t.features.map(function(t){return t.properties.sovereignt}).filter(this.onlyUnique).sort();$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select a country",data:d}).on("select2:select",r)},t.prototype.mapMouseIn=function(t){d3.select(this).style("stroke","black").style("stroke-width","1.5px")},t.prototype.mapMouseOut=function(t){d3.select(this).style("stroke","black").style("stroke-width","0.5px")},t.prototype.createLegend=function(t,e,a){console.log(e);var r,n=e.width/30,i=e.height/2,o=t.append("g").attr("class","map-legend").attr("id","map-legend").on("click",function(t){console.log(this),console.log(d3.selectAll("#map-legend-text").style("opacity")),console.log(typeof d3.selectAll("#map-legend-text").style("opacity")),console.log("1"===d3.selectAll("#map-legend-text").style("opacity")),"1"===d3.selectAll("#map-legend-text").style("opacity")?(d3.selectAll("#map-legend-text").style("opacity",0),d3.selectAll("#map-legend-item").style("opacity",0),d3.selectAll("#map-legend-rect").attr("width","68px"),d3.selectAll("#map-legend-rect").attr("height","25px"),o.append("text").text("Legend").attr("x",n-2).attr("y",i-2.5).style("font-size","14px").attr("id","map-legend-title")):(d3.selectAll("#map-legend-text").style("opacity",1),d3.selectAll("#map-legend-item").style("opacity",1),d3.selectAll("#map-legend-rect").attr("width","185px"),d3.selectAll("#map-legend-rect").attr("height","200px"),d3.selectAll("#map-legend-rect").text("Legend"),d3.select("#map-legend-title").remove())});for(o.append("rect").attr("x",n-10).attr("y",i-20).attr("width","185px").attr("height","200px").attr("class","map-legend-rect").attr("id","map-legend-rect").style("stroke","black").style("fill","white").style("rx","8px"),o.append("text").style("font-size","14px").style("padding-top","10px").style("color","lightgrey").attr("class","map-legend-text").attr("id","map-legend-text").attr("x",n).attr("y",i-20),o.append("text").text("Expected change in cases").style("font-size","14px").style("padding-top","10px").attr("class","map-legend-text").attr("id","map-legend-text").attr("x",n).attr("y",i),r=0;r<Object.entries(a).length;r++)o.append("rect").attr("x",n).attr("y",i+200/7*(r+1)+5-20).style("width","12px").style("height","12px").style("fill",Object.entries(a)[r][1]).attr("class","map-legend-item").attr("id","map-legend-item"),o.append("text").attr("x",23+n).attr("y",i+200/7*(r+1)+15-20).text(Object.entries(a)[r][0]).style("font-size","12px").style("padding-left","10px").attr("class","map-legend-item").attr("id","map-legend-item")},t.prototype.calculateScaleCenter=function(t,e,a,r){var n=r.bounds(t),i=120/Math.max((n[1][0]-n[0][0])/e,(n[1][1]-n[0][1])/a),o=d3.geoBounds(t);return{scale:i,center:[(o[1][0]+o[0][0])/2,(o[1][1]+o[0][1])/2]}},t.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},t}(rtVis),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var ts=function(a){function t(t){var e=a.call(this,t)||this;return e.margin={top:10,right:30,bottom:30,left:60},e}return __extends(t,a),t.prototype.plotTs=function(n,e,t,a,i,r,o){void 0===r&&(r=void 0),void 0===o&&(o=!1),d3.select("#"+i+"-svg").remove(),d3.select("#"+i+"-tooltip").remove(),n=n.filter(function(t){return t.country==e});try{a=a.filter(function(t){return t.region==e})}catch(t){}try{s=o?null:d3.max(a,function(t){return parseFloat(t.confirm)})}catch(t){var s=null}var c=d3.timeParse("%Y-%m-%d"),l=d3.select("#"+i).append("svg").attr("class",i+"-svg").attr("id",i+"-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),d=document.getElementById(i).getBoundingClientRect();d.width=d.width-this.margin.left-this.margin.right,d.height=d.height-this.margin.top-this.margin.bottom;var p=d3.min(n,function(t){return c(t.date)});"7d"===t?p=new Date(Date.now()-6048e5):"14d"===t?p=new Date(Date.now()-12096e5):"30d"===t&&(p=new Date(Date.now()-2592e6)),n=n.filter(function(t){return c(t.date)>=p});try{a=a.filter(function(t){return d3.timeDay.offset(c(t.date),-1)>=p})}catch(t){}if(0!==n.length){var u=d3.max(n,function(t){return c(t.date)});try{var h=d3.max(a,function(t){return parseFloat(t.confirm)})}catch(t){}var f=d3.max(n,function(t){return parseFloat(t.upper_90)});if(!o)try{f=this.gt_max_observed_cases(d3.max([f,h]),s)}catch(t){}var y=d3.scaleLinear().domain([0,f]).range([d.height,0]),g=d3.scaleTime().domain([p,u]).range([0,d.width]),m=d3.line().x(function(t){return g(c(t.date))}).y(function(t){return y(1)}).curve(d3.curveCardinal),v=n.filter(function(t){return"estimate"==t.type}),_=n.filter(function(t){return"estimate based on partial data"==t.type}),x=n.filter(function(t){return"forecast"==t.type}),D=this.plotHPoly("date","upper_90","lower_90",g,y,c,s,this.gt_max_observed_cases),b=this.plotHPoly("date","upper_50","lower_50",g,y,c,s,this.gt_max_observed_cases);if(!o)try{l.selectAll("rect").data(a).enter().append("rect").attr("x",function(t,e){return g(d3.timeDay.offset(c(t.date),-.5))}).attr("width",function(t){return.8*(g(d3.timeDay.offset(c(t.date),1))-g(c(t.date)))}).attr("height",0).attr("y",d.height).transition().duration(250).delay(function(t,e){return 4*e}).attr("height",function(t,e){return d.height-y(t.confirm)}).attr("y",function(t,e){return y(t.confirm)}).attr("class","cases_bar")}catch(t){}l.append("path").datum(v).attr("d",D).attr("class","poly_90_e"),l.append("path").datum(_).attr("d",D).attr("class","poly_90_eb"),l.append("path").datum(x).attr("d",D).attr("class","poly_90_f"),l.append("path").datum(v).attr("d",b).attr("class","poly_50_e"),l.append("path").datum(_).attr("d",b).attr("class","poly_50_eb"),l.append("path").datum(x).attr("d",b).attr("class","poly_50_f"),o&&l.append("path").datum(n).attr("d",m).attr("class","r0_line").style("stroke","black").style("stroke-dasharray","5,5"),l.append("g").attr("transform","translate(0,"+d.height+")").call(d3.axisBottom(g)).attr("class","r0-xaxis"),l.append("g").call(d3.axisLeft(y)).attr("class","r0-yaxis"),l.append("line").attr("id",i+"-hover-line").attr("x1",20).attr("y1",0).attr("x2",20).attr("y2",d.height).attr("stroke","black").attr("stroke-width","1px").attr("stroke-opacity",0),void 0!==r&&l.append("line").attr("id","run-date-line").attr("x1",g(c(r))).attr("y1",0).attr("x2",g(c(r))).attr("y2",d.height).attr("stroke","lightgrey").style("stroke-dasharray","5,5");var w=d3.select("#"+i).append("div").style("opacity",0).attr("class",i+"-tooltip").attr("id",i+"-tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px").style("font-size","9pt").style("overflow","visible").style("position","relative").style("display","inline-block"),k=/\B(?=(\d{3})+(?!\d))/g,A=this.gt_max_observed_cases;l.append("rect").attr("class","overlay").attr("width",d.width).attr("height",d.height).on("mousemove",function(){var e=this;d3.select("#"+i+"-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0]);var t=n.filter(function(t){return c(t.date).toDateString()==g.invert(d3.mouse(e)[0]).toDateString()}),a="<b>"+c(t[0].date).toDateString()+"</b><br>50% CI: "+parseFloat(A(t[0].lower_50,s)).toString().replace(k,",")+" to "+parseFloat(A(t[0].upper_50,s)).toString().replace(k,",")+"<br>90% CI: "+parseFloat(A(t[0].lower_90,s)).toString().replace(k,",")+" to "+parseFloat(A(t[0].upper_90,s)).toString().replace(k,","),r=d.width-d3.mouse(this)[0]<80?-70:70;w.html(a).style("left",d3.mouse(this)[0]+r+"px").style("top",d3.mouse(this)[1]-200+"px")}).on("mouseenter",function(t){d3.select("#"+i+"-tooltip").style("opacity",1),d3.select("#"+i+"-hover-line").attr("stroke-opacity",1)}).on("mouseout",function(t){d3.select("#"+i+"-tooltip").style("opacity",0),d3.select("#"+i+"-hover-line").attr("stroke-opacity",0)}).attr("fill-opacity","0")}else l.append("text").attr("x",d.width/2).attr("y",d.height/2).text("No data").style("font-size","20px").style("stroke-width",0).style("fill","gray")},t.prototype.plotAllTs=function(t,e,a,r,n){void 0===n&&(n=void 0),this.tsCountryTitle(t,"country-title-container"),null!==a.rtData[r].rtData&&(this.plotTs(a.rtData[r].rtData,t,e,a.rtData[r].obsCasesData,"r0-ts-container",n,!0),this.tsDataTitle("R","r0-title-container")),null!==a.rtData[r].casesInfectionData&&(this.plotTs(a.rtData[r].casesInfectionData,t,e,a.rtData[r].obsCasesData,"cases-infection-ts-container",n,!1),this.tsDataTitle("Cases by date of infection","cases-infection-title-container")),null!==a.rtData[r].casesReportData&&(this.plotTs(a.rtData[r].casesReportData,t,e,a.rtData[r].obsCasesData,"cases-report-ts-container",n,!1),this.tsDataTitle("Cases by date of report","cases-report-title-container"))},t.prototype.tsDataTitle=function(t,e){d3.select("#"+e).text(t)},t.prototype.tsCountryTitle=function(t,e){try{var a=Object.keys(this._subregional_ref).includes(t)?'<a href="'+this._subregional_ref[t]+'" target="_blank" style="font-size:14px;">Detailed estimates available</a>':""}catch(t){}d3.select("#"+e).html(t);try{d3.select("#"+e).append("div").attr("id","subregional-link").html(a)}catch(t){}},t.prototype.plotHPoly=function(e,a,r,n,i,o,s,c){return void 0===o&&(o=null),null!==o?d3.area().x(function(t){return n(o(t[e]))}).y0(function(t){return i(c(t[a],s))}).y1(function(t){return i(c(t[r],s))}):d3.area().x(function(t){return n(t[e])}).y0(function(t){return i(c(t[a],s))}).y1(function(t){return i(c(t[r],s))})},t.prototype.gt_max_observed_cases=function(t,e){return null!==e&&10*e<=t?10*e:t},t}(rtVis);